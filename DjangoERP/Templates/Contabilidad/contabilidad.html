{% load static django_bootstrap5 %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contabilidad</title>
    {% bootstrap_css %}
    <link rel="stylesheet" href="{% static 'styles.css' %}">
</head>
<body>
    <div class="top-bar">
        {% if user.is_authenticated %}
            <a href="{% url 'usuarios:logistics' %}" class="btn btn-secondary">Volver</a>
            <div class="dropdown">
                <button type="button" class="btn btn-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    {{ user.nombre }}
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="{% url 'usuarios:logout' %}">Cerrar sesión</a></li>
                </ul>
            </div>
        {% endif %}
    </div>

    <div class="container">
        <h1>Gestión de Contabilidad</h1>
        
        <div class="btn-group" role="group" aria-label="Opciones de Contabilidad">
            <input type="radio" class="btn-check" name="contabilidad_options" id="btnradio1" autocomplete="off" checked>
            <label class="btn btn-outline-primary compact-btn" for="btnradio1">Saldo</label>

            <input type="radio" class="btn-check" name="contabilidad_options" id="btnradio2" autocomplete="off">
            <label class="btn btn-outline-primary compact-btn" for="btnradio2">Movimientos</label>

            <input type="radio" class="btn-check" name="contabilidad_options" id="btnradio3" autocomplete="off">
            <label class="btn btn-outline-primary compact-btn" for="btnradio3">Ganancias</label>
        </div>

        <div id="contabilidad-content" class="mt-4">
            <!-- Sección Saldo -->
            <div id="saldo-section" class="content-section" style="display: block;">
                <p class="fs-3">${{ budget.monto }}</p>
            </div>

            <!-- Sección Movimientos -->
            <div id="movimientos-section" class="content-section" style="display: none;">
                <div class="table-container">
                    <table class="user-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Monto</th>
                                <th>Descripción</th>
                                <th>ID Pedido</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaccion in transacciones %}
                            <tr>
                                <td>{{ transaccion.fecha|date:"d/m/Y H:i" }}</td>
                                <td>{{ transaccion.get_tipo_display }}</td>
                                <td>${{ transaccion.monto }}</td>
                                <td>{{ transaccion.descripcion }}</td>
                                <td>{{ transaccion.pedido.id_pedido|default:"N/A" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5">No hay transacciones registradas.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <!-- Paginador -->
                {% if transacciones.has_other_pages %}
                <nav aria-label="Page navigation example" class="mt-4">
                    {% bootstrap_pagination transacciones url="?page=" %}
                </nav>
                {% endif %}
            </div>

            <!-- Sección Ganancias -->
            <div id="ganancias-section" class="content-section" style="display: none;">
                <p class="fs-3 {% if ganancias_perdidas >= 0 %}text-success{% else %}text-danger{% endif %}">
                    Total desde el inicio: ${{ ganancias_perdidas }}
                </p>
            </div>
        </div>
    </div>

    {% bootstrap_javascript %}
    <script>
        // Función para mostrar la sección correcta
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';
        }

        // Manejar clics en los radio buttons
        document.querySelectorAll('.btn-check').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.id === 'btnradio1') {
                    showSection('saldo-section');
                } else if (this.id === 'btnradio2') {
                    showSection('movimientos-section');
                } else if (this.id === 'btnradio3') {
                    showSection('ganancias-section');
                }
            });
        });

        // Al cargar la página, verificar si hay un parámetro 'page' y mostrar 'Movimientos'
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('page')) {
                document.getElementById('btnradio2').checked = true; // Seleccionar "Movimientos"
                showSection('movimientos-section');
            } else {
                // Mantener el comportamiento por defecto (Saldo seleccionado)
                document.getElementById('btnradio1').checked = true;
                showSection('saldo-section');
            }
        });
    </script>
</body>
</html>